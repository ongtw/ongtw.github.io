<html>
  <head>
    <title>Optimizing NLP Code 01</title>
    <style>
pre.code {
    white-space: pre-wrap;
}

pre.code:before {
    counter-reset: listing;
}

pre.code code {
    counter-increment: listing;
}

pre.code code:before {
    content: counter(listing) ". ";
    display: inline-block;
    width: 8em;         /* doesn't work */
    padding-left: auto; /* doesn't work */
    margin-left: auto;  /* doesn't work */
    text-align: right;  /* doesn't work */
}
    </style>
  </head>
  <body>
    <h1>Optimizing NLP Code 01</h1>
    <p>Junior Programmer (JP) wrote some python code to determine which rows in a pandas dataframe likely contains English text.
      JP's code took 4+ hours to run on a 600 row dataframe (the text column is standard paragraph length, say 100 words on average).
      JP's code is listed below:</p>
    <pre>
      # ... other imports left out for brevity ...
      from nltk.stem import WordNetLemmatizer
      from nltk.corpus import words
      
      lemmatizer = WordNetLemmatizer()      
      sp = spacy.load("en_core_web_sm", disable=["ner"])

      # Get all the percentage of sentences with english words
      percentageValidEng = []
      for index, row in df.iterrows():
          # number of words per row
          numWords = len(row['POS'])
          # append True or False
          validity = []
          for token in sp(row['Text']):
              if (lemmatizer.lemmatize(token.text.lower()) in words.words()) == True:
                  validity.append(1)
          percentageValidEng.append(len(validity)/numWords)
    </pre>
  </body>
</html>
